/*SVE ZA BAZE*/

/* -------------------------------------------------------------------- */


CREATE TABLE korisnik
(
  email VARCHAR(50) NOT NULL,
  idKorisnik INT NOT NULL,
  username VARCHAR(100) NOT NULL,
  uloga INT NOT NULL DEFAULT 0,
  koristi INT NOT NULL DEFAULT 1,
  PRIMARY KEY (email),
  UNIQUE (idKorisnik)
);

CREATE TABLE oglas
(
  datum TIMESTAMP NOT NULL,
  ulica VARCHAR(50) NOT NULL,
  grad VARCHAR(50) NOT NULL,
  kucnibr VARCHAR(50) NOT NULL,
  opis VARCHAR(1000) NOT NULL,
  idOglas INT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  aktivan INT NOT NULL,
  tipOglas INT NOT NULL,
  opisZamjene VARCHAR(1000),
  email VARCHAR(50) NOT NULL,
  PRIMARY KEY (idOglas),
  FOREIGN KEY (email) REFERENCES KORISNIK(email)
);

CREATE TABLE tipdog
(
  nazivtipa VARCHAR(100) NOT NULL,
  idDog INT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  PRIMARY KEY (idDog)
);

CREATE TABLE ulaznica
(
  red INT,
  broj INT,
  vrstaUlaznice INT,
  idUlaznica INT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  cijena FLOAT,
  idOglas INT NOT NULL,
  PRIMARY KEY (idUlaznica),
  FOREIGN KEY (idOglas) REFERENCES oglas(idOglas)
);

CREATE TABLE volioglas
(
  voli INT NOT NULL,
  email VARCHAR(50) NOT NULL,
  idOglas INT NOT NULL,
  PRIMARY KEY (email, idOglas),
  FOREIGN KEY (email) REFERENCES KORISNIK(email),
  FOREIGN KEY (idOglas) REFERENCES oglas(idOglas)
);

CREATE TABLE jetip
(
  idDog INT NOT NULL,
  idOglas INT NOT NULL,
  PRIMARY KEY (idDog, idOglas),
  FOREIGN KEY (idDog) REFERENCES tipdog(idDog),
  FOREIGN KEY (idOglas) REFERENCES oglas(idOglas)
);

CREATE TABLE nadtransakcija
(
  dvNadPocetak TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,  
  idNadtransakcija INT NOT NULL GENERATED BY DEFAULT AS IDENTITY, 
  ukupno integer NOT NULL DEFAULT 0,
  PRIMARY KEY (idNadtransakcija )
 
);

CREATE TABLE transakcija
(
  idTransakcija INT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  uspjesna INT NOT NULL DEFAULT 0,
  dvPocetak TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  idUlaznica INT NOT NULL,
  idNadtransakcija INT,
  PRIMARY KEY (idTransakcija),
  FOREIGN KEY (idUlaznica) REFERENCES ulaznica(idUlaznica),
  FOREIGN KEY (idNadtransakcija) REFERENCES nadtransakcija(idNadtransakcija)
);

CREATE TABLE jeukljucen
(
  odluka INT NOT NULL DEFAULT 0,
  email VARCHAR(50) NOT NULL,
  idTransakcija INT NOT NULL,
  PRIMARY KEY (email, idTransakcija),
  FOREIGN KEY (email) REFERENCES KORISNIK(email),
  FOREIGN KEY (idTransakcija) REFERENCES transakcija(idTransakcija)
);

CREATE TABLE semijenja
(
  idUlaznica INT NOT NULL,
  idTransakcija INT NOT NULL,
  PRIMARY KEY (idUlaznica, idTransakcija),
  FOREIGN KEY (idUlaznica) REFERENCES ulaznica(idUlaznica),
  FOREIGN KEY (idTransakcija) REFERENCES transakcija(idTransakcija)
);

CREATE TABLE spor
(
  idSpor INT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  opisSpor VARCHAR(1000) NOT NULL,
  dvSpor TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  odlukaSpor INT NOT NULL DEFAULT 0,
  obrazlozenje VARCHAR(1000),
  tuzioEmail VARCHAR(50) NOT NULL,
  tuzenEmail VARCHAR(50) NOT NULL,
  PRIMARY KEY (idSpor),
  FOREIGN KEY (tuzioEmail) REFERENCES korisnik(email),
  FOREIGN KEY (tuzenEmail) REFERENCES korisnik(email)
);
/* -------------------------------------------------------------------- */
/* pripazite na port koji su vam baze i promjenite ga u aplication.properties*/

CREATE USER "pone" WITH PASSWORD 'Qw234!*2?';
GRANT ALL PRIVILEGES ON DATABASE "progi" TO pone;
GRANT ALL PRIVILEGES ON TABLE jetip TO pone;
GRANT ALL PRIVILEGES ON TABLE jeukljucen TO pone;
GRANT ALL PRIVILEGES ON TABLE korisnik TO pone;
GRANT ALL PRIVILEGES ON TABLE oglas TO pone;
GRANT ALL PRIVILEGES ON TABLE semijenja TO pone;
GRANT ALL PRIVILEGES ON TABLE tipdog TO pone;
GRANT ALL PRIVILEGES ON TABLE transakcija TO pone;
GRANT ALL PRIVILEGES ON TABLE ulaznica TO pone;
GRANT ALL PRIVILEGES ON TABLE volioglas TO pone;
GRANT ALL PRIVILEGES ON TABLE nadtransakcija TO pone;
GRANT ALL PRIVILEGES ON TABLE spor TO pone;
/* -------------------------------------------------------------------- */

